---
# # # # #  Bash  # # # # #

- name: "Require Correct Linux Distribution"
  assert:
    that: ansible_distribution | lower in ['redhat', 'centos']
    msg:  "This Linux distrution is not supported by the role."
  tags: bash

- name: "Remove Unwanted Scripts"
  file: path="{{ item }}" state=absent
  with_items:
   - /etc/motd
   - /etc/profile.d/colorls.sh
   - /etc/profile.d/colorls.csh
  tags: bash

- name: "Login Script"
  copy: src=etc/bashrc dest=/etc/bashrc force=yes mode='0644'
  tags: bash

- name: "Copy configuration Files"
  copy:
    src:   etc/profile.d
    dest:  /etc
    force: yes
    mode:  '0644'
    directory_mode: '0755'
  tags: bash

- name: "Global profile.d Scripts"
  template:
    src:  "etc/profile.d/{{ item }}.j2"
    dest: "/etc/profile.d/{{ item }}"
    mode: '0644'
    force: yes
  with_items:
   - 00-provisioner-vars.sh
  tags: bash

- name: "Custom profile.d Scripts"
  template:
    src:  "etc/profile.d/script.sh.j2"
    dest: "/etc/profile.d/{{ profile_script.name }}.sh"
    mode: '0644'
    force: yes
  with_items:
   - "{{ bash_profile_d | default([]) }}"
  loop_control:
    loop_var: profile_script
  tags: bash

- name: "Advanced MOTD"
  include: motd.yml
  when: bash_advanced_motd | default(True)
  tags: bash

- name: "User Configuration Files"
  become: yes
  become_user: "{{ user.username }}"
  include: user.yml
  with_items:
   - "{{ bash_users | default([]) }}"
  loop_control:
    loop_var: user
  tags: bash

- name: "Files Permissions"
  file:
    path:   "{{ item }}"
    owner:  root
    group:  root
    seuser: system_u
    serole: object_r
    setype: etc_t
  with_items:
    - /etc/profile.d
    - /etc/motd.d
    - /etc/bashrc
  tags: bash
